\chapter{Introduction}

The arrival of the Internet has completely revolutionized our personal and professional lives. With the rapid growth of the Internet, all the market sectors, social networking services, advertising and non-commerical sectors are using this technology in their workflow. As we become more dependent on the online environment, we can see massive growth of opportunities for IT criminals to take advantage of user systems. 

Internet users often share sensitive information like bank account details or other personal information, over the network. As personal computers and mobile phones became an important part in most people`s lives, these computers became a hub of user`s personal information. In this world of ubiquitous computers and persistent threats from hackers, protecting your computer is a must. Several websites are hacked to be used as distributors of malware, to infect the visitors unknowingly with viruses and malware. A single visit to a such a hacked web page is sufficient for an intruder to get control of a user`s machine.

In late 2013, one of the bank`s internal computers that are used by employees to process and record daily transactions, had been infected with malware \cite{bib7}. The malware continuously monitored the bank`s activities for several months, sending back images and video feeds to cybercriminals about the bank`s daily routines. Then the cybercriminals impersonated bank officers, turned on several cash machines and also transferred millions of dollars from banks into dummy accounts of other countries.

Consider the fact that more than 6,600 benign websites are getting hacked every single day \cite{bib6}. These legitimate websites are turned into distributors of malware by malicious hackers. Malicious code can be injected into legitimate Javascript of a benign web page. When a user visits such a compromised website, this malicious JavaScript will be executed in the victim`s web browser. Execution of such malicious JavaScript can infect the victim`s personal computer. Most of the times, malicious JavaScript redirects the victim`s web browser to load more malicious code from a remote server. This can be achieved through several means, such as adding an HTML iframe element to a page. Always cybercriminals try to obfuscate the malicious content from detection. HTML provides very few ways to obfuscate the code such as adding an HTML iframe element to a page but the huge number of methods in JavaScript makes it easy to heavily obfuscate the malicious code into Javascript.

\section{Problem} 

Malware is malicious software, specifically designed to gain access to the data or to damage the resources without the knowledge of victim \cite{bib4}. Researchers developed various techniques for malware detection like signature based detection and heuristic analysis. To overcome the malware detection techniques, malware writers came up with different types of malwares among which metamorphic malware is an advanced version. Metamorphic malware is capable of changing its internal structure without altering its functionality from infection to infection. Due to the metamorphic nature, such malware is very difficult to detect. With a huge set of functions, JavaScript makes it possible for virus writers to develop malicious JavaScript code with metamorphic feature. Transcriptase is such a case, which is designed to infect other JavaScript files in the same folder \cite{bib5}.

\section{Proposed Solution}

In spite of the fact that malware can change their internal structure the priority order of the important commands cannot be changed. Case in point, consider a sample JavaScript code below,

\begin{figure}
  \centering

\begin{lstlisting}[language=JavaScript]
//sample.js
<script>
    var x = 5;
    var y = 6;
    var z = x + y;
</script>
\end{lstlisting}

\begin{lstlisting}[language=JavaScript]
//sample_morphed.js - obfuscated version of sample.js
<script>
    var y_renamed = 6;
    var x_renamed = 5;
    var z_renamed = x_renamed + y_renamed;
</script>
\end{lstlisting}

    \caption[JavaScript Sample and its obfuscated version.]{JavaScript Sample and its obfuscated version.}
\label{fig:jssample}
\end{figure}

From the code in Figure~\ref{fig:jssample}, it is clear that even though the variable names are changed and the order of declaration of $x$ and $y$  (or $x$\_$renamed$ and $y$\_$renamed$) are changed, the arithmetic operation always follows the declaration of those two variables else the code may give syntactical errors or the wrong result.

So, we can make use of the opcodes statistical information to detect the malware. 

\section{A Browser Plugin for Detecting Malware}

Generally JavaScript malware will be injected into benign web pages. When a user visits this infected website, the malicious JavaScript code will be executed in the browser. To prevent this, we can develop an add-on which will monitor the JavaScript content of every web page and the browser can disable the JavaScript execution before the page gets loaded. The add-on will analyze the JavaScript in the background and will enable the JavaScript load, if the web page is found to be benign or else warn the user about malicious content without loading the JavaScript. This procedure can secure the victim`s computer from malware infection. For this research, we can use the Transcriptase metamorphic JavaScript malware.

The remaining of the paper is organized as follows. In Chapter 2, we provide background information on metamorphic malware and with an emphasis on Transcriptase metamorphic JavaScript malware that forms the basis for the research. Also in this chapter, we cover the Rhino Javascript engine. Chapter 3 outlines the details of Firefox add-on development. Then in Chapter 4, we discuss two different static metamorphic detection techniques that we apply to detect the metamorphic JavaScript malware. In Chapter 5, we present the accuracy and performance details of Firefox add-on using opcode similarity detection technique. Our experimental results for the original metamorphic JavaScript appear. Chapter 6 contains the conclusion and consideration for future work.